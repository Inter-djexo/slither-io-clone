(()=>{function e(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return n(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){l=!0,s=e},f:function(){try{a||null==o.return||o.return()}finally{if(l)throw s}}}}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=Array(n);t<n;t++)o[t]=e[t];return o}console.log("Game.js loaded successfully!");var t,o,r,i,s=document.getElementById("start-screen"),a=document.getElementById("death-screen"),l=document.getElementById("game-ui"),c=document.getElementById("player-name"),m=document.getElementById("start-button"),d=document.getElementById("restart-button"),f=document.getElementById("length"),y=document.getElementById("final-length"),g=document.getElementById("leaders"),h={name:"",size:10,segments:[],color:"",score:0},u={},v=[],E=!1,p=!1,w=new THREE.Vector2;function x(){h.name=c.value.trim()||"Player"+Math.floor(1e3*Math.random()),h.color="#"+Math.floor(16777215*Math.random()).toString(16),signInAnonymously().then((function(){!function(){try{(t=io()).on("connect",(function(){console.log("Connected to server")})),t.on("connect_error",(function(e){console.error("Socket.io connection error:",e),alert("Error connecting to server. Please refresh the page and try again.")})),t.on("gameState",(function(n){for(var o in n.players)o!==t.id&&H(o,n.players[o]);var r,i=e(n.food);try{for(i.s();!(r=i.n()).done;)z(r.value)}catch(e){i.e(e)}finally{i.f()}})),t.on("newPlayer",(function(e){H(e.id,e)})),t.on("playerMoved",(function(e){!function(e,n){if(u[e]){u[e].segments.length>0&&(u[e].segments[0].mesh.position.set(n.x,n.y,0),u[e].segments[0].x=n.x,u[e].segments[0].y=n.y);for(var t=n.segments?n.segments.length:0;u[e].segments.length<t+1;){var o=u[e].segments[u[e].segments.length-1];T(e,o.x,o.y)}for(var r=0;r<t;r++)if(r+1<u[e].segments.length){var i=n.segments[r];u[e].segments[r+1].mesh.position.set(i.x,i.y,0),u[e].segments[r+1].x=i.x,u[e].segments[r+1].y=i.y}u[e].size=n.size}else H(e,n)}(e.id,e)})),t.on("foodUpdate",(function(n){!function(n){var t,r=e(v);try{for(r.s();!(t=r.n()).done;){var i=t.value;o.remove(i.mesh)}}catch(e){r.e(e)}finally{r.f()}v=[];var s,a=e(n);try{for(a.s();!(s=a.n()).done;)z(s.value)}catch(e){a.e(e)}finally{a.f()}}(n)})),t.on("playerKilled",(function(e){e===t.id?S():R(e)})),t.on("playerDisconnected",(function(e){R(e)}))}catch(e){console.error("Error initializing Socket.io:",e),alert("Error initializing game. Please refresh the page and try again.")}}(),s.style.display="none",l.style.display="block",p=!0,E=!0}))}function M(){var e=new THREE.CircleGeometry(20,32),n=new THREE.MeshBasicMaterial({color:h.color}),t=new THREE.Mesh(e,n);o.add(t),h.segments=[{mesh:t,x:0,y:0}],h.size=10,b()}function H(e,n){if(!u[e]){u[e]={id:e,name:n.name||"Player",segments:[],color:n.color,size:n.size};var t=new THREE.CircleGeometry(20,32),r=new THREE.MeshBasicMaterial({color:n.color}),i=new THREE.Mesh(t,r);i.position.set(n.x,n.y,0),o.add(i);var s=function(e){var n=document.createElement("canvas"),t=n.getContext("2d");n.width=256,n.height=64,t.font="24px Arial",t.fillStyle="white",t.textAlign="center",t.fillText(e,128,24);var o=new THREE.CanvasTexture(n),r=new THREE.SpriteMaterial({map:o}),i=new THREE.Sprite(r);return i.position.set(0,40,0),i.scale.set(100,25,1),i}(n.name,n.color);if(i.add(s),u[e].segments.push({mesh:i,x:n.x,y:n.y}),n.segments&&n.segments.length>0)for(var a=0;a<n.segments.length;a++){var l=n.segments[a];T(e,l.x,l.y)}}}function T(e,n,t){var r=new THREE.CircleGeometry(18,32),i=new THREE.MeshBasicMaterial({color:u[e].color}),s=new THREE.Mesh(r,i);s.position.set(n,t,0),o.add(s),u[e].segments.push({mesh:s,x:n,y:t})}function R(n){if(u[n]){var t,r=e(u[n].segments);try{for(r.s();!(t=r.n()).done;){var i=t.value;o.remove(i.mesh)}}catch(e){r.e(e)}finally{r.f()}delete u[n]}}function z(e){if(!v.some((function(n){return n.id===e.id}))){var n=new THREE.CircleGeometry(10,16),t=new THREE.MeshBasicMaterial({color:e.color||16777215}),r=new THREE.Mesh(n,t);r.position.set(e.x,e.y,0),o.add(r),v.push({id:e.id,mesh:r,x:e.x,y:e.y})}}function b(){f.textContent=h.size}function S(){p=!1,E=!1,saveHighScore(h.name,h.size),y.textContent=h.size,a.style.display="flex",l.style.display="none";var n,t=e(h.segments);try{for(t.s();!(n=t.n()).done;){var r=n.value;o.remove(r.mesh)}}catch(e){t.e(e)}finally{t.f()}h.segments=[]}function B(){if(0!==h.segments.length){var e=h.segments[h.segments.length-1],n=new THREE.CircleGeometry(18,32),t=new THREE.MeshBasicMaterial({color:h.color}),r=new THREE.Mesh(n,t);r.position.copy(e.mesh.position),o.add(r),h.segments.push({mesh:r,x:e.x,y:e.y})}else M()}function I(){requestAnimationFrame(I),E&&p&&(function(){if(0!==h.segments.length){var e=new THREE.Vector3(w.x,w.y,0).normalize(),n=h.segments[0],o=n.x+3*e.x,i=n.y+3*e.y;n.mesh.position.set(o,i,0),n.x=o,n.y=i,r.position.set(o,i,r.position.z);for(var s=h.segments.length-1;s>0;s--){var a=h.segments[s],l=h.segments[s-1],c=l.x-a.x,m=l.y-a.y,d=Math.sqrt(c*c+m*m);if(d>5){var f=c*(d-5)/d,y=m*(d-5)/d;a.x+=f,a.y+=y,a.mesh.position.set(a.x,a.y,0)}}var g=h.segments.slice(1).map((function(e){return{x:e.x,y:e.y}}));t.emit("playerMovement",{x:n.x,y:n.y,size:h.size,segments:g})}else M()}(),function(){if(0!==h.segments.length)for(var e=h.segments[0].x,n=h.segments[0].y,r=v.length-1;r>=0;r--){var i=v[r];Math.sqrt(Math.pow(e-i.x,2)+Math.pow(n-i.y,2))<30&&(h.size+=1,b(),h.segments.length<100&&B(),t.emit("eatFood",i.id),o.remove(i.mesh),v.splice(r,1))}}(),function(){if(0!==h.segments.length){var e=h.segments[0].x,n=h.segments[0].y;for(var o in u){for(var r=u[o],i=1;i<r.segments.length;i++){var s=r.segments[i];if(Math.sqrt(Math.pow(e-s.x,2)+Math.pow(n-s.y,2))<30)return t.emit("playerDeath",t.id),void S()}var a=r.segments[0].x,l=r.segments[0].y;if(Math.sqrt(Math.pow(e-a,2)+Math.pow(n-l,2))<30){if(h.size<=r.size)return t.emit("playerDeath",t.id),void S();t.emit("playerDeath",o),h.size+=Math.ceil(r.size/4),b(),h.segments.length<100&&B()}}}}(),function(){if(0!==h.segments.length){var e=h.segments[0].x,n=h.segments[0].y;Math.sqrt(e*e+n*n)>2500&&(t.emit("playerDeath",t.id),S())}}(),function(){g.innerHTML="";var n=[];for(var t in n.push({name:h.name,score:h.size,isLocal:!0}),u)n.push({name:u[t].name,score:u[t].size,isLocal:!1});n.sort((function(e,n){return n.score-e.score}));var o,r=e(n.slice(0,10));try{for(r.s();!(o=r.n()).done;){var i=o.value,s=document.createElement("li");s.innerHTML="<span>".concat(i.name,"</span><span>").concat(i.score,"</span>"),i.isLocal&&(s.style.color="#00ff00",s.style.fontWeight="bold"),g.appendChild(s)}}catch(e){r.e(e)}finally{r.f()}}()),i.render(o,r)}window.addEventListener("load",(function(){!function(){(o=new THREE.Scene).background=new THREE.Color(1579032);var e=window.innerWidth/window.innerHeight,n=1e3;(r=new THREE.OrthographicCamera(-1e3*e/2,n*e/2,500,-500,1,1e4)).position.z=1e3,(i=new THREE.WebGLRenderer({antialias:!0})).setSize(window.innerWidth,window.innerHeight),document.getElementById("game-container").appendChild(i.domElement),function(){var e=new THREE.GridHelper(5e3,50,4473924,2236962);e.rotation.x=Math.PI/2,o.add(e);var n=new THREE.RingGeometry(2490,2500,64),t=new THREE.MeshBasicMaterial({color:65280,side:THREE.DoubleSide,transparent:!0,opacity:.3}),r=new THREE.Mesh(n,t);r.rotation.x=Math.PI/2,o.add(r)}(),window.addEventListener("resize",(function(){var e=window.innerWidth/window.innerHeight;r.left=-1e3*e/2,r.right=n*e/2,r.top=500,r.bottom=-500,r.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)}))}(),m.addEventListener("click",x),d.addEventListener("click",(function(){a.style.display="none",s.style.display="flex"})),document.addEventListener("mousemove",(function(e){p&&(w.x=e.clientX/window.innerWidth*2-1,w.y=-e.clientY/window.innerHeight*2+1)})),I(),l.style.display="none"}))})();